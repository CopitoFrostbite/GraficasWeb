<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PawPush Paradise</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <button type="button" id="btn-login">Iniciar sesión con Google</button>
    <button type="button" id="btn-logout">Logout</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {
            getAuth,
            signOut,
            signInWithPopup,
            GoogleAuthProvider,
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import {
            getDatabase,
            ref,
            set,
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC2mOZQoo7TglXRBkFH6zYg35T4B9uTwKY",
            authDomain: "pawpush-2f014.firebaseapp.com",
            databaseURL: "https://pawpush-2f014-default-rtdb.firebaseio.com",
            projectId: "pawpush-2f014",
            storageBucket: "pawpush-2f014.appspot.com",
            messagingSenderId: "294052268906",
            appId: "1:294052268906:web:512db7f61d11c8ebf73313",
            measurementId: "G-79Q2V2CQDL"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const db = getDatabase(app);
        let currentUser;

        const buttonLogin = document.getElementById("btn-login");
        const buttonLogout = document.getElementById("btn-logout");

        buttonLogin.addEventListener("click", async function () {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                currentUser = user;
                await set(ref(db, 'users/' + user.uid), {
                    uid: user.uid,
                    displayName: user.displayName,
                    email: user.email,
                    players: {
                        player1: { x: 0, y: 0, z: 0 },
                        player2: { x: 0, y: 0, z: 0 },
                        player3: { x: 0, y: 0, z: 0 },
                        player4: { x: 0, y: 0, z: 0 }
                    }
                });
                console.log("User logged in: ", user);
                window.location.href = 'juego.html';
            } catch (error) {
                console.error('Error en el inicio de sesión:', error);
            }
        });

        buttonLogout.addEventListener("click", async function () {
            try {
                await signOut(auth);
                console.log("Sign-out successful");
            } catch (error) {
                console.error("An error happened during sign-out:", error);
            }
        });
    </script>

    <img src="../assets/pictures/logo1.jpg" alt="PawPush Paradise Logo" class="logo">
    <div id="main-menu" class="panel">
        <ul>
            <li><a href="../views/juego.html" id="play">Jugar</a></li>
            <li><a href="../views/config.html" id="options">Opciones</a></li>
            <li><a href="../views/score.html" id="score">Puntaje</a></li>
        </ul>
        <img src="../assets/pictures/art2.png" alt="PawPush Paradise Art" class="art">
    </div>
</body>
</html>
